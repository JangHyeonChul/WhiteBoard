<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="layout/basic">
<head th:replace="fragements/header">
    <meta charset="UTF-8">
    <title>상세</title>
</head>
<body>
<div th:replace="fragements/bodyHeader"></div>
<div class="app-header-space"></div>
<div class="app-layout">
    <div class="app-member-content-header"><i class="fas fa-lightbulb"></i> 게시글 상세</div>

    <table border="1px">
        <thead>
        <tr>
            <th>UID</th>
            <th>ID</th>
            <th>Title</th>
            <th>Content</th>
            <th>Created At</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td th:text="${board.uid}"></td>
            <td th:text="${board.created_user}"></td>
            <td th:text="${board.title}"></td>
            <td th:text="${board.content}"></td>
            <td th:text="${board.created_at}"></td>
        </tr>
        </tbody>
    </table>

    <div>
        <h3>댓글 작성</h3>
        <form id="comment-form">
            <label for="created_user">작성자</label>
            <input type="text" id="created_user" name="created_user"><br>

            <label for="comment">내용</label>
            <textarea id="comment" name="comment"></textarea><br>

            <button type="submit">작성하기</button>
        </form>
    </div>

    <div>
        <h3>댓글 목록</h3>
        <ul id="comment-list"></ul>
    </div>
</div>
</div>

<script>
    const boardUid = new URLSearchParams(window.location.search).get('uid');

    const commentForm = document.querySelector('#comment-form');
    const commentList = document.querySelector('#comment-list');

    commentForm.addEventListener('submit', (event) => {
        event.preventDefault();

        const createdUser = commentForm.elements['created_user'].value;
        const comment = commentForm.elements['comment'].value;

        fetch(`/board/comment?boardUid=${boardUid}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ created_user: createdUser, comment: comment }),
        })
            .then(response => response.json())
            .then(data => {
                // 새로운 댓글 요소를 생성하고 추가합니다.
                const newComment = document.createElement('li');
                newComment.textContent = data.created_user + ' - ' + data.comment;
                commentList.appendChild(newComment);

                // 입력창을 초기화합니다.
                commentForm.elements['created_user'].value = '';
                commentForm.elements['comment'].value = '';
            })
            .catch(error => {
                console.error('Error:', error);
            });
    });

    // 초기 로딩시 댓글 목록을 불러옵니다.
    fetch(`/board/comment?boardUid=${boardUid}`)
        .then(response => response.json())
        .then(data => {
            // 기존 댓글을 모두 삭제합니다.
            commentList.innerHTML = '';

            // 새로운 댓글 요소들을 생성하고 추가합니다.
            data.forEach(comment => {
                const newComment = document.createElement('li');
                newComment.textContent = comment.created_user + ' - ' + comment.comment;
                commentList.appendChild(newComment);
            });
        })
        .catch(error => {
            console.error('Error:', error);
        });
</script>
</body>
</html>